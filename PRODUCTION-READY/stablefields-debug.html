<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêû StableFields Debug - Quick Error Check</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #1a1a1a; 
            color: white; 
            padding: 20px; 
        }
        .error { color: #ff6b6b; background: rgba(255, 107, 107, 0.1); padding: 10px; margin: 10px 0; border-left: 4px solid #ff6b6b; }
        .success { color: #51cf66; background: rgba(81, 207, 102, 0.1); padding: 10px; margin: 10px 0; border-left: 4px solid #51cf66; }
        .warning { color: #ffd43b; background: rgba(255, 212, 59, 0.1); padding: 10px; margin: 10px 0; border-left: 4px solid #ffd43b; }
        button { 
            background: #339af0; 
            color: white; 
            border: none; 
            padding: 10px 15px; 
            margin: 5px; 
            border-radius: 4px; 
            cursor: pointer; 
        }
        button:hover { background: #228be6; }
        #console-output { 
            background: #000; 
            padding: 15px; 
            border-radius: 4px; 
            font-family: monospace; 
            max-height: 400px; 
            overflow-y: auto; 
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üêû StableFields Quick Debug</h1>
    <p>This page tests for common errors in the StableFields app.</p>
    
    <button onclick="testAddToStable()">Test addToStable Function</button>
    <button onclick="testAPIProxy()">Test API Proxy (No Auth)</button>
    <button onclick="testImportEndpoints()">Test Import Endpoints</button>
    <button onclick="testZedSight()">Test ZedSight API</button>
    <button onclick="clearOutput()">Clear Output</button>
    
    <div id="results"></div>
    <h3>Console Output:</h3>
    <div id="console-output"></div>

    <script>
        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        const consoleOutput = document.getElementById('console-output');
        
        function addToOutput(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.textContent += `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToOutput(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToOutput(args.join(' '), 'error');
        };
        
        function showResult(message, type) {
            const results = document.getElementById('results');
            results.innerHTML += `<div class="${type}">${message}</div>`;
        }
        
        function clearOutput() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('console-output').textContent = '';
        }
        
        function testAddToStable() {
            try {
                // Test if addToStable function exists
                if (typeof window.addToStable === 'function') {
                    showResult('‚úÖ addToStable function exists globally', 'success');
                } else {
                    showResult('‚ùå addToStable function not found globally', 'error');
                }
                
                // Test if we can access it from the StableFields context
                fetch('/stablefields-tracker.html')
                    .then(response => response.text())
                    .then(html => {
                        if (html.includes('function addToStable')) {
                            showResult('‚úÖ addToStable function found in HTML file', 'success');
                        } else {
                            showResult('‚ùå addToStable function not found in HTML file', 'error');
                        }
                    })
                    .catch(error => {
                        showResult('‚ùå Could not check HTML file: ' + error.message, 'error');
                    });
                    
            } catch (error) {
                showResult('‚ùå Error testing addToStable: ' + error.message, 'error');
            }
        }
        
        async function testImportEndpoints() {
            try {
                console.log('Testing import endpoints...');
                
                // Test racing endpoint
                const racingResponse = await fetch('/api/zed/racing');
                const racingData = await racingResponse.json();
                
                if (racingResponse.status === 401 || racingData.error === 'fetch failed') {
                    showResult('‚úÖ Racing endpoint reachable (expected auth error)', 'success');
                } else if (racingResponse.status === 404) {
                    showResult('‚ùå Racing endpoint returns 404', 'error');
                } else {
                    showResult('‚ö†Ô∏è Racing endpoint unexpected response: ' + racingResponse.status, 'warning');
                }
                
                // Test breeding endpoint  
                const breedingResponse = await fetch('/api/zed/breeding');
                const breedingData = await breedingResponse.json();
                
                if (breedingResponse.status === 401 || breedingData.error === 'fetch failed') {
                    showResult('‚úÖ Breeding endpoint reachable (expected auth error)', 'success');
                } else if (breedingResponse.status === 404) {
                    showResult('‚ùå Breeding endpoint returns 404', 'error');
                } else {
                    showResult('‚ö†Ô∏è Breeding endpoint unexpected response: ' + breedingResponse.status, 'warning');
                }
                
            } catch (error) {
                showResult('‚ùå Error testing import endpoints: ' + error.message, 'error');
            }
        }
        
        async function testAPIProxy() {
            try {
                console.log('Testing API proxy without authentication...');
                
                const response = await fetch('/api/zed/me');
                const data = await response.json();
                
                if (response.status === 401) {
                    showResult('‚úÖ API proxy correctly returns 401 for protected endpoint without auth', 'success');
                } else if (response.status === 500) {
                    showResult('‚ùå API proxy returns 500 error instead of 401', 'error');
                    showResult('Response: ' + JSON.stringify(data, null, 2), 'warning');
                } else {
                    showResult('‚ö†Ô∏è Unexpected response status: ' + response.status, 'warning');
                    showResult('Response: ' + JSON.stringify(data, null, 2), 'warning');
                }
            } catch (error) {
                showResult('‚ùå Error testing API proxy: ' + error.message, 'error');
            }
        }
        
        async function testZedSight() {
            try {
                console.log('Testing ZedSight API...');
                
                const response = await fetch('https://pqchju22ku.us-east-1.awsapprunner.com/api/search-horse?name=test');
                const data = await response.json();
                
                if (response.ok) {
                    showResult('‚úÖ ZedSight API is accessible', 'success');
                    showResult('Response: ' + JSON.stringify(data, null, 2), 'success');
                } else {
                    showResult('‚ùå ZedSight API error: ' + response.status, 'error');
                }
            } catch (error) {
                showResult('‚ùå Error testing ZedSight API: ' + error.message, 'error');
            }
        }
        
        // Auto-run basic tests on load
        window.addEventListener('load', function() {
            console.log('üêû StableFields Debug Tool loaded');
            setTimeout(testAddToStable, 1000);
            setTimeout(testAPIProxy, 2000);
            setTimeout(testImportEndpoints, 3000);
        });
    </script>
</body>
</html>
